"use strict";(()=>{var e={};e.id=8398,e.ids=[8398],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},28285:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>C,patchFetch:()=>P,requestAsyncStorage:()=>v,routeModule:()=>y,serverHooks:()=>q,staticGenerationAsyncStorage:()=>w});var o={};r.r(o),r.d(o,{GET:()=>f,HEAD:()=>h,POST:()=>x});var s=r(49303),a=r(88716),n=r(60670),i=r(20021),p=r(56342),d=r(315),c=r(76129),l=r(51414),u=r(94750),m=r(16292);async function g(e,t){let r=e.body?.getReader();if(!r)throw Error("No reader available");return new ReadableStream({async start(e){let o=new TextDecoder,s="";for(t?.onStart?.();;){let{done:a,value:n}=await r.read();if(a){e.close(),t?.onFinal?.(s),t?.onCompletion?.(s);return}if(n){e.enqueue(n);let r=o.decode(n);t?.onToken?.(r),s+=r}}},cancel(){r.releaseLock()}})}async function h(){return Response.json("",{status:i.Xd.apiKey?200:401})}async function f(){if(i.Xd?.config?.apiKey?.toLowerCase()!=="codegpt enterprise")return Response.json("Oops! The selected model has a potential configuration conflict. Please ensure that all your open instances of VSCode have the same provider.",{status:400});let e=i.Xd?.secrets?.["CodeGPT Enterprise_customLink"];try{let t=i.Xd.secrets?.["CodeGPT Enterprise_orgId"];if(!i.Xd.apiKey)return Response.json({agents:[],marketplace:[]});let r={Authorization:`Bearer ${i.Xd.apiKey||""}`,"Content-Type":"application/json",...t?{"CodeGPT-Org-Id":t}:{},"Access-Control-Allow-Origin":"*"},o=await Promise.all([fetch(`${e}/agents`,{headers:r}).then(e=>e.json()),fetch(`${e}/agents/marketplace-favorites`,{headers:r}).then(e=>e.json())]);return Response.json({agents:Array.isArray(o[0])?o[0]:[],marketplace:Array.isArray(o[1])?o[1]:[]})}catch(e){return console.log(e),Response.json(e.message,{status:e.status??500})}}async function x(e){var t;if(i.Xd?.config?.apiKey?.toLowerCase()!=="codegpt enterprise")return Response.json("Oops! The selected model has a potential configuration conflict. Please ensure that all your open instances of VSCode have the same provider.",{status:400});let r=i.Xd?.secrets?.["CodeGPT Enterprise_customLink"],{messages:o}=await e.json(),s=(o=(0,d.D)({messages:o}))[o.length-1],{image:a}=s,n=a?"gpt-4o":e.headers.get("model"),h="true"===e.headers.get("fromMarketplace"),f=e.headers.get("promptType"),x=await u.Z.getLanguage(),y=await u.Z.getIdeLanguage(),v=e.headers.get("fileName")??"",w="Chat",q=s?.codeSelection??"";if(f){w=f+"CodeGPT";let e=(0,c.u)({promptType:f,cleanPromptText:s.content+q,language:y});e&&(o[o.length-1].content=e+s.content+q)}let C=(t=(t=n??"").toLowerCase(),!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(t));C&&(a?o=[{role:"system",content:[{type:"text",text:"Create a detailed description of the image.\n\nYou have provided an image. I will describe it unless you provide a specific instruction."}]},{role:"user",content:[{type:"image_url",image_url:{url:a,detail:"high"}},...s.content?[{type:"text",text:s.content}]:[]]}]:o.unshift({role:"system",content:"Act as an expert UX/UI designer. Create a detailed description of the image.\n\nYou have provided an image. I will describe it unless you provide a specific instruction.\n\nI am a helpful programming expert assistant. If you ask me a question that is rooted in truth. Follow the user's instructions with precision and attention to detail. Provide the code in a single block. Minimize any additional text."}));try{let e=i.Xd.secrets?.["CodeGPT Plus Beta_orgId"],t=!!i.Xd?.apiKey,s=i.Xd?.globalState?.config,a={...t?C?{model:n?.toLowerCase()}:{agentId:n}:{model:"gpt-3.5-turbo"},messages:o,temperature:s?.temperature??.3},c=t?C?`${r}/chat/completion`:h?`${r}/chat/marketplace/agents`:`${r}/chat/extension`:`${r}/chat/limited`;o=(0,d.V)(o);let u=await fetch(c,{method:"POST",headers:{Authorization:`Bearer ${i.Xd.apiKey||""}`,"Content-Type":"application/json",tokens:"true",source:"api",channel:process.env.SOURCE||"vscode",...e?{"CodeGPT-Org-Id":e}:{}},body:JSON.stringify(a)});if(console.log({url:c,body:a}),(0,p.q)({eventName:w,provider:"CodeGPT Enterprise",model:C?n??"gpt-3.5-turbo":"agentId: "+n,statusCode:u.status}),429===u.status)return Response.json({message:"You have reached the daily limit of requests. Please wait until the next period starts or upgrade your plan."},{status:429});let y=await g(u),P=o.slice(0,-1).some(e=>e.content.includes(q));if(q&&(f||!P)){let e=await (0,l.VU)([`<p style='display: flex; align-items: center; gap: 0.5rem;'>${f?`<span class='command command-bordered command-with-icon' data-command='command'><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${f}</span></span>`:""}${v?`<span class='command command-bordered command-with-icon animate-slideIn relative h-auto items-center gap-1 overflow-hidden' data-id=${x} data-language=${x}><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${v}</span></span>`:""}</p>`],y);return new m.wn(e)}return new m.wn(y)}catch(e){return(0,p.q)({eventName:w,provider:"CodeGPT Enterprise",model:C?n??"gpt-3.5-turbo":"agentId: "+n,statusCode:e.status??500}),Response.json({message:e.message,status:e.status??500},{status:e.status??500})}}let y=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/[port]/api/(providers)/(codegpt)/codegptenterprise/route",pathname:"/[port]/api/codegptenterprise",filename:"route",bundlePath:"app/[port]/api/(providers)/(codegpt)/codegptenterprise/route"},resolvedPagePath:"/Users/maol/WebstormProjects/Trabajo/codegpt-nextjs/app/[port]/api/(providers)/(codegpt)/codegptenterprise/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:v,staticGenerationAsyncStorage:w,serverHooks:q}=y,C="/[port]/api/(providers)/(codegpt)/codegptenterprise/route";function P(){return(0,n.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:w})}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,1203,50,4104,6292,7179,6342,8910],()=>r(28285));module.exports=o})();