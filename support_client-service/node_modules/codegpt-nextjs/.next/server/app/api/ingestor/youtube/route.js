"use strict";(()=>{var e={};e.id=7707,e.ids=[7707],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},91121:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>T,patchFetch:()=>j,requestAsyncStorage:()=>m,routeModule:()=>w,serverHooks:()=>y,staticGenerationAsyncStorage:()=>x});var n={};a.r(n),a.d(n,{POST:()=>b});var r=a(49303),s=a(88716),o=a(60670);let i=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i,u="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36,gzip(gfe)",l=/<text start="([^"]*)" dur="([^"]*)">([^<]*)<\/text>/g;class c extends Error{constructor(e){super(`[YoutubeTranscript] ðŸš¨ ${e}`)}}class p extends c{constructor(){super("YouTube is receiving too many requests from this IP and now requires solving a captcha to continue")}}class d extends c{constructor(e){super(`The video is no longer available (${e})`)}}class g extends c{constructor(e){super(`Transcript is disabled on this video (${e})`)}}class h extends c{constructor(e){super(`No transcripts are available for this video (${e})`)}}class v extends c{constructor(e,t,a){super(`No transcripts are available in ${e} this video (${a}). Available languages: ${t.join(", ")}`)}}class f{static fetchTranscript(e,t){var a,n,r,s,o;return n=this,r=void 0,s=void 0,o=function*(){let n=this.retrieveVideoId(e),r=yield fetch(`https://www.youtube.com/watch?v=${n}`,{headers:Object.assign(Object.assign({},(null==t?void 0:t.lang)&&{"Accept-Language":t.lang}),{"User-Agent":u})}),s=yield r.text(),o=s.split('"captions":');if(o.length<=1){if(s.includes('class="g-recaptcha"'))throw new p;if(!s.includes('"playabilityStatus":'))throw new d(e);throw new g(e)}let i=null===(a=(()=>{try{return JSON.parse(o[1].split(',"videoDetails')[0].replace("\n",""))}catch(e){return}})())||void 0===a?void 0:a.playerCaptionsTracklistRenderer;if(!i)throw new g(e);if(!("captionTracks"in i))throw new h(e);if((null==t?void 0:t.lang)&&!i.captionTracks.some(e=>e.languageCode===(null==t?void 0:t.lang)))throw new v(null==t?void 0:t.lang,i.captionTracks.map(e=>e.languageCode),e);let c=((null==t?void 0:t.lang)?i.captionTracks.find(e=>e.languageCode===(null==t?void 0:t.lang)):i.captionTracks[0]).baseUrl,f=yield fetch(c,{headers:Object.assign(Object.assign({},(null==t?void 0:t.lang)&&{"Accept-Language":t.lang}),{"User-Agent":u})});if(!f.ok)throw new h(e);return[...(yield f.text()).matchAll(l)].map(e=>{var a;return{text:e[3],duration:parseFloat(e[2]),offset:parseFloat(e[1]),lang:null!==(a=null==t?void 0:t.lang)&&void 0!==a?a:i.captionTracks[0].languageCode}})},new(s||(s=Promise))(function(e,t){function a(e){try{u(o.next(e))}catch(e){t(e)}}function i(e){try{u(o.throw(e))}catch(e){t(e)}}function u(t){var n;t.done?e(t.value):((n=t.value)instanceof s?n:new s(function(e){e(n)})).then(a,i)}u((o=o.apply(n,r||[])).next())})}static retrieveVideoId(e){if(11===e.length)return e;let t=e.match(i);if(t&&t.length)return t[1];throw new c("Impossible to retrieve Youtube video ID.")}}async function b(e){let{url:t}=await e.json();try{let e=await f.fetchTranscript(t);return Response.json({status:200,transcript:e})}catch(e){return Response.json({message:e.message,status:e.status??500},{status:e.status??500})}}let w=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/ingestor/youtube/route",pathname:"/api/ingestor/youtube",filename:"route",bundlePath:"app/api/ingestor/youtube/route"},resolvedPagePath:"/Users/maol/WebstormProjects/Trabajo/codegpt-nextjs/app/api/ingestor/youtube/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:y}=w,T="/api/ingestor/youtube/route";function j(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:x})}},49303:(e,t,a)=>{e.exports=a(30517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[8948],()=>a(91121));module.exports=n})();